<!DOCTYPE html>
<html lang="en">
<head>
  <title>index</title>
  <link rel="stylesheet" type="text/css" href="/style.css">
  <!-- <script src="./client.js"></script> -->

  <script>
    const statusStruct = {
      200: 'Success',
      201: 'Created',
      400: 'Bad Request',
    };

    const handleResPost = async (res) => {
      const content = document.querySelector('#content');

      if (res.status === 400) {
        const json = await res.json();
        let responseHTML = `<h1>${statusStruct[res.status]}</h1>`;
        responseHTML += `<p>${json.message}</p>`;
        content.innerHTML = responseHTML;
        return;
      } window.location.href = './game.html';
    };

    const sendPost = async (url, createLobby) => {
      const nameField = createLobby.querySelector('#nameField');
      const team1Field = createLobby.querySelector('#team1Field');
      const team2Field = createLobby.querySelector('#team2Field');

      const formData = `name=${nameField.value}&team1=${team1Field.value}&team2=${team2Field.value}`;

      const res = await fetch(url, {
        method: 'post',
        headers: {
          'Content-Type': 'application/x-www-form-urlencoded',
          Accept: 'application/json',
        },
        body: formData,
      });

      handleResPost(res);
    };

    const init = () => {
      const createLobby = document.querySelector('#createLobby');

      createLobby.addEventListener('submit', (event) => {
        sendPost('/createLobby', createLobby);
        event.preventDefault();
      });
    };

    window.onload = init;
  </script>
  
</head>
<body>
    <section id="top">
        <form id="createLobby" method="post">
            <label for="name">Lobby Name: </label>
            <input id = "nameField" type="text" name="name" />
            <label for="team1">Team 1: </label>
            <input id = "team1Field" type="text" name="team1" />
            <label for="team2">Team 2: </label>
            <input id = "team2Field" type="text" name="team2" />
            <input type="submit" value="Create Lobby"/>
        </form>
        <br>
        <select id="joinLobby">
        </select>
    </section>
    <section id="content">
    </section>
</body>
</html>
